<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Brotabs — The Polished Timeline</title>
  <meta name="color-scheme" content="dark"/>
  <style>
    :root{
      --bg: #05050A;
      --primary: #7F5AF0;
      --text: #D9D9F3;
      --muted: #9492A1;
      --panel: rgba(18, 18, 30, 0.6);
      --border: rgba(127, 90, 240, 0.2);
      --border-hover: rgba(127, 90, 240, 0.9);
      --glow: 0 0 40px rgba(127, 90, 240, 0.4);
      --radius: 18px;
      --glass: blur(12px) saturate(130%);
    }

    *{box-sizing:border-box; cursor: none;}
    html,body{height:100%; width:100%; overflow:hidden;}

    body{
      margin:0;
      color:var(--text);
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background: var(--bg);
      position: relative;
    }

    /* Large circular glow following cursor (desktop) */
    .cursor-glow{
      position:fixed;
      left:0;
      top:0;
      width:720px;
      height:720px;
      border-radius:50%;
      pointer-events:none;
      z-index:-1;
      background:radial-gradient(circle at center,
        rgba(127, 90, 240, 0.48) 0%,
        rgba(127, 90, 240, 0.16) 38%,
        transparent 70%);
      filter:blur(10px);
      opacity:0.95;
      transform:translate3d(-50%,-50%,0); /* centers on left/top */
    }

    /* FX canvas only for particle trail (desktop) */
    #fx {
      position:fixed;
      inset:0;
      z-index:50;
      pointer-events:none;
    }

    /* Bottom Navigation (desktop / default) */
    .bottom-nav {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 50px;
        background: var(--panel);
        padding: 10px 30px;
        border-radius: 99px;
        border: 1px solid var(--border);
        backdrop-filter: var(--glass);
    }
    .nav-link {
        display: flex;
        align-items: center;
        gap: 10px;
        text-decoration: none;
    }
    .nav-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #fff;
        box-shadow: 0 0 8px rgba(255,255,255,0.5);
        transition: transform 0.4s ease, box-shadow 0.4s ease, background-color 0.4s ease;
    }
    .nav-link.active .nav-dot {
        transform: scale(1.5);
        background: var(--primary);
        box-shadow: var(--glow);
    }
    .nav-link .label {
        color: var(--muted);
        font-size: 14px;
        font-weight: 500;
        transition: color 0.4s ease;
    }
    .nav-link:hover .label { color: var(--text); }
    .nav-link.active .label { color: var(--text); }

    /* Main Scroll Container (desktop) */
    main {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        will-change: transform;
    }
    .scroll-track {
        display: flex;
        align-items: center;
        gap: 12vw;
        padding: 0 15vw;
        position: relative;
    }
    .track-line {
        position: absolute;
        top: 50%;
        left: 0;
        width: 100%;
        height: 1px;
        background: linear-gradient(90deg, transparent, var(--border) 10%, var(--border) 90%, transparent);
        transform: translateY(-50%);
        z-index: -1;
    }

    /* Content Stops */
    .stop {
        flex-shrink: 0;
        position: relative;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    .intro-stop {
        width: 70vw;
        max-width: 850px;
        flex-direction: column;
        align-items: flex-start;
        justify-content: center;
    }
    .intro-stop h1 {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: clamp(40px, 7vw, 72px);
        line-height: 1.05;
        letter-spacing: -0.02em;
        margin: 0;
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 20px;
    }
    .hero-logo { height: 1em; animation: float-logo 6s ease-in-out infinite; }
    @keyframes float-logo { 50% { transform: translateY(-8px); } }

    .intro-stop p {
        color: var(--muted);
        font-size: clamp(16px, 2vw, 19px);
        max-width: 55ch;
        margin: 20px 0 0 0;
        line-height: 1.7;
        text-align: left;
    }

    .projects-stop { 
        display: flex;
        flex-direction: row;
        gap: 60px;
        justify-content: center;
        align-items: center;
    }

    .outro-stop {
        width: 70vw;
        max-width: 900px;
        display: flex;
        justify-content: center;
        align-items: center;
        text-align: center;
    }

    /* Interactive Contact Node */
    .contact-node {
        position: relative;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        color: var(--text);
    }
    .contact-node .node-orb {
        width: 120px;
        height: 120px;
        border-radius: 50%;
        background: var(--primary);
        border: 1px solid transparent;
        box-shadow: var(--glow);
        display: grid;
        place-items: center;
        transition: all 0.4s ease;
        animation: pulse 2.5s infinite ease-in-out;
    }
    .contact-node .node-orb svg {
        stroke: #fff;
        transition: transform 0.4s ease;
    }
    .contact-node:hover .node-orb {
        transform: scale(1.1);
        background: transparent;
        border-color: var(--border-hover);
        box-shadow: var(--glow);
    }
    .contact-node:hover .node-orb svg { transform: scale(1.1); }
    .contact-node .node-text {
        margin-top: 20px;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        font-size: 18px;
        transition: color 0.3s ease;
    }
    .contact-node:hover .node-text { color: #fff; }
    @keyframes pulse { 50% { box-shadow: 0 0 50px rgba(127, 90, 240, 0.6); } }

    /* Cards */
    .card{
      position:relative;
      border-radius:var(--radius);
      width: 400px;
      background:
        radial-gradient(circle at 50% 0%, rgba(127, 90, 240, 0.18), transparent 55%),
        var(--panel);
      backdrop-filter: var(--glass);
      border:1px solid var(--border);
      padding:28px;
      transition:
        transform 0.45s cubic-bezier(.2,.8,.2,1),
        box-shadow 0.45s ease,
        border-color 0.45s ease;
      will-change: transform;
    }
    .card:hover{
        transform: translateY(-10px) scale(1.03);
        border-color: var(--border-hover);
        box-shadow: var(--glow);
    }
    .card::before {
        content: '';
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        width: 1px;
        height: 10vh;
        background: linear-gradient(to top, var(--border), transparent);
    }
    .card-content {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 24px;
        align-items: start;
    }
    .card-text-group { display: flex; flex-direction: column; }
    .card h3{
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        margin: 0 0 8px 0;
        font-size: 24px;
        font-weight: 600;
        line-height: 1.2;
    }
    .card p {
        color:var(--muted);
        font-size: 16px;
        line-height: 1.6;
        margin: 0;
    }

    /* Icon Styling */
    .icon { width: 48px; height: 48px; transition: filter 0.4s ease; }
    .card:hover .icon { filter: drop-shadow(0 0 12px var(--primary)); }
    .icon svg {
        width: 100%;
        height: 100%;
        stroke: var(--primary);
        stroke-width: 1.5;
        fill: none;
        stroke-linecap: round;
        stroke-linejoin: round;
    }

    /* Scroll reveal animation for mobile */
    .reveal-card {
      opacity: 0;
      transform: translateY(32px);
      transition: opacity 0.6s ease, transform 0.6s ease;
    }
    .reveal-card.visible {
      opacity: 1;
      transform: translateY(0);
    }

    /* Detail View Modal */
    .detail-view {
        position: fixed;
        inset: 0;
        z-index: 100;
        display: grid;
        place-items: center;
        background: rgba(10,10,18,0.5);
        backdrop-filter: blur(10px);
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.5s ease, visibility 0.5s ease;
    }
    .detail-view.active { opacity: 1; visibility: visible; }
    .detail-view-content {
        width: min(90vw, 800px);
        max-height: 80vh;
        overflow-y: auto;
        padding: 40px;
        background: #0D0D17;
        border: 1px solid var(--border-hover);
        border-radius: var(--radius);
        box-shadow: var(--glow);
        transform: scale(0.8);
        transition: transform 0.5s cubic-bezier(.2,.8,.2,1);
        transform-origin: 50% 50%;
    }
    .detail-view.active .detail-view-content { transform: scale(1); }
    .detail-view h2 { font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; font-size: 32px; }
    .detail-view p { color: var(--muted); line-height: 1.8; }
    .tag{
      display:inline-flex;
      gap:8px;
      align-items:center;
      font-size:14px;
      color:var(--text);
      background:rgba(127, 90, 240,0.14);
      border:1px solid rgba(127, 90, 240,0.35);
      padding:8px 12px;
      border-radius:999px;
    }
    .meta{ display:flex; gap:12px; flex-wrap:wrap; margin-top:20px }

    /* Button in Modal */
    .btn {
        display:inline-flex;
        gap:12px;
        align-items:center;
        padding:14px 20px;
        border-radius:12px;
        background:var(--panel);
        border:1px solid transparent;
        color:var(--text);
        text-decoration:none;
        transition: all .3s ease;
        will-change: transform, box-shadow;
        box-shadow: inset 0 0 0 1px var(--border);
        cursor: pointer;
    }
    .btn:hover{
        transform: translateY(-3px);
        box-shadow: inset 0 0 0 1px var(--border-hover), var(--glow);
    }
    .btn.primary {
        background:var(--primary);
        border-color: transparent;
        box-shadow: 0 0 24px rgba(127, 90, 240, 0.8);
        color: #fff;
    }
    .btn.primary:hover { background: transparent; color: var(--text); }

    /* Magnetic + Cursor (desktop) */
    .magnetic{ position:relative; display:inline-flex; }
    .cursor{
      position:fixed;
      left:0;
      top:0;
      pointer-events:none;
      z-index:9999;
    }
    .cursor .dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background: var(--text);
      position:absolute;
      transform: translate(-50%,-50%);
    }
    .cursor .halo{
      width:40px;
      height:40px;
      border-radius:50%;
      background: var(--primary);
      position:absolute;
      transform: translate(-50%,-50%);
      opacity:0;
      filter: blur(20px);
      transition: width .3s ease, height .3s ease, opacity .3s ease;
    }
    .cursor.active .halo{ width:60px; height:60px; opacity:0.3 }
    .cursor.drag .halo { opacity: 0.5; filter: blur(25px); }

    /* ------------ MOBILE OVERRIDES: vertical layout, no cursor/glow/FX ----------- */
    @media (max-width: 768px) {
      html, body {
        height: auto;
        overflow: auto;
      }

      * {
        cursor: auto;
      }

      .cursor {
        display: none;
      }

      #fx {
        display: none;
      }

      .cursor-glow{
        display:none;
      }

      body{
        background:
          radial-gradient(circle at 100% 100%, rgba(127, 90, 240, 0.45), transparent 55%),
          #05050A;
      }

      .bottom-nav {
        top: 16px;
        bottom: auto;
        width: calc(100% - 32px);
        left: 50%;
        transform: translateX(-50%);
        justify-content: space-between;
        gap: 16px;
        padding: 8px 16px;
      }

      main {
        position: static;
        width: 100%;
        height: auto;
        align-items: flex-start;
        padding-top: 96px;
      }

      .scroll-track {
        flex-direction: column;
        align-items: stretch;
        gap: 56px;
        padding: 0 16px 40px;
      }

      .track-line {
        display: none;
      }

      .stop {
        width: 100%;
        justify-content: flex-start;
      }

      .intro-stop {
        min-height: calc(100vh - 120px);
        align-items: flex-start;
        justify-content: center;
      }

      .projects-stop {
        flex-direction: column;
        align-items: stretch;
        width: 100%;
      }

      .card {
        width: 100%;
        max-width: none;
      }

      .card::before {
        display: none;
      }

      .outro-stop {
        width: 100%;
        max-width: none;
        justify-content: center;
      }

      .contact-node {
        margin: 0 auto 40px;
      }
    }
  </style>
</head>
<body>
  <div class="cursor-glow" id="cursor-glow"></div>
  <canvas id="fx" aria-hidden="true"></canvas>

  <nav class="bottom-nav">
    <a href="#" class="nav-link magnetic" data-scroll-to="0" data-section="intro">
        <div class="nav-dot"></div>
        <span class="label">Home</span>
    </a>
    <a href="#" class="nav-link magnetic" data-scroll-to="0.5" data-section="projects">
        <div class="nav-dot"></div>
        <span class="label">Projects</span>
    </a>
    <a href="#" class="nav-link magnetic" data-scroll-to="1" data-section="outro">
        <div class="nav-dot"></div>
        <span class="label">Contact</span>
    </a>
  </nav>

  <div class="cursor" id="cursor" aria-hidden="true">
    <div class="halo"></div>
    <div class="dot"></div>
  </div>

  <main id="main-track-container">
    <div class="scroll-track" id="scroll-track">
      <div class="track-line"></div>

      <div class="stop intro-stop" data-stop-id="intro">
        <h1>
            <img src="logo.png" alt="Brotabs Logo" class="hero-logo">
            <span>Brotabs</span>
        </h1>
        <p>We build impossibly fast, intuitive software that feels less like a utility, and more like an extension of your mind.</p>
      </div>

      <div class="stop projects-stop" id="projects-container" data-stop-id="projects">
        <!-- Project cards injected here -->
      </div>

      <div class="stop outro-stop" data-stop-id="outro">
        <a href="mailto:hello@brotabs.dev" class="contact-node magnetic">
          <div class="node-orb">
             <svg width="32" height="32" viewBox="0 0 24 24" fill="none"
                  stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
               <line x1="5" y1="12" x2="19" y2="12"></line>
               <polyline points="12 5 19 12 12 19"></polyline>
             </svg>
          </div>
          <div class="node-text">Transmit Inquiry</div>
        </a>
      </div>
    </div>
  </main>
  
  <div class="detail-view" id="detail-view">
    <div class="detail-view-content">
        <h2 id="detail-title"></h2>
        <p id="detail-desc"></p>
        <div class="meta" id="detail-tags"></div>
        <div id="detail-buttons" style="margin-top: 24px; display: flex; gap: 16px;">
            <!-- Buttons are injected here -->
        </div>
    </div>
  </div>

  <script>
    const isTouchDevice = ('ontouchstart' in window) || (navigator.maxTouchPoints > 0) || (navigator.msMaxTouchPoints > 0);
    const isMobileLayout = window.matchMedia('(max-width: 768px)').matches;
    const useCustomScroll = !isMobileLayout;

    // --- DATA ---
    const projectData = [
      {
        id: 'arsen',
        svg: '<svg viewBox="0 0 24 24"><path d="M4 4l16 8-8 2-2 8-6-18z"></path></svg>',
        title: 'Arsen Autoclicker',
        short: 'Free & lightweight mouse automation with advanced hotkey and macro support for any workflow.',
        long: 'Arsen Autoclicker: free, lightweight, precise mouse automation with 1–100 CPS, single/double clicks, custom intervals/patterns, global hotkeys, macro record/playback, low CPU, reliable long sessions, clean UI for beginners, deep controls for power users; no ads, no bloat, works across games, apps, and workflows.',
        url: 'https://arsengg.netlify.app/',
        tags: [{icon: 'Tech', text: 'PyQt'}, {icon: 'Latency', text: '1ms target'}]
      },
      {
        id: 'next',
        svg: '<svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" /></svg>',
        title: 'Coming Soon',
        short: 'A new paradigm for productivity is on the horizon. Our next-generation tool is in development. STAY TUNED.',
        long: 'We are currently in the deep development phase for our next flagship product. It is being built on a new architecture to redefine what is possible in creative and productive workflows. More details will be revealed soon.',
        tags: [{icon: 'State', text: 'In Development'}, {icon: 'ETA', text: 'Est. 2026'}]
      }
    ];

    // --- CURSOR, GLOW & MAGNETIC ---
    const cursor = document.getElementById('cursor');
    const glow = document.getElementById('cursor-glow');
    let cx = innerWidth/2, cy = innerHeight/2, tx = cx, ty = cy;
    let gx = innerWidth/2, gy = innerHeight/2;

    if (!isTouchDevice && !isMobileLayout) {
      window.addEventListener('mousemove',(e)=>{
        tx = e.clientX;
        ty = e.clientY;
      }, {passive:true});

      (function cursorLoop(){
        cx += (tx-cx)*0.2;
        cy += (ty-cy)*0.2;
        cursor.style.transform = `translate(${cx}px, ${cy}px)`;

        if (glow) {
          gx += (tx-gx)*0.12;
          gy += (ty-gy)*0.12;
          glow.style.left = gx + 'px';
          glow.style.top  = gy + 'px';
        }
        requestAnimationFrame(cursorLoop);
      })();
    } else {
      if (cursor) cursor.style.display = 'none';
      if (glow) glow.style.display = 'none';
    }

    function setupMagneticButtons() {
      const elements = document.querySelectorAll('.magnetic');
      if (isTouchDevice || isMobileLayout) {
        elements.forEach(el => { el.style.transform = 'none'; });
        return;
      }
      elements.forEach(el=>{
        const strength = 20;
        el.addEventListener('mouseenter', ()=> cursor.classList.add('active'));
        el.addEventListener('mouseleave', ()=> {
          cursor.classList.remove('active');
          el.style.transform='';
        });
        el.addEventListener('mousemove', (e)=>{
          const r = el.getBoundingClientRect();
          const x = e.clientX - (r.left + r.width/2);
          const y = e.clientY - (r.top + r.height/2);
          el.style.transform = `translate(${x/strength}px, ${y/strength}px)`;
        });
      });
    }

    // --- SCROLL / NAV ---
    const track = document.getElementById('scroll-track');
    const navLinks = document.querySelectorAll('.bottom-nav .nav-link');
    const introStop = document.querySelector('[data-stop-id="intro"]');
    const projectsStop = document.querySelector('[data-stop-id="projects"]');
    const outroStop = document.querySelector('[data-stop-id="outro"]');

    let currentScroll = 0, targetScroll = 0;
    let isModalActive = false;

    function updateScroll() {
      if (!useCustomScroll || isModalActive) return;

      currentScroll += (targetScroll - currentScroll) * 0.1;
      if (Math.abs(targetScroll - currentScroll) < 0.001) currentScroll = targetScroll;

      const maxScroll = track.scrollWidth - innerWidth;
      const scrollValue = -currentScroll * maxScroll;
      track.style.transform = `translateX(${scrollValue}px)`;
    }

    let isDragging = false, startDragX = 0;

    if (!isTouchDevice && useCustomScroll) {
      window.addEventListener('wheel', e => {
        e.preventDefault();
        const scrollDelta = e.deltaY + e.deltaX;
        targetScroll += scrollDelta * 0.0007;
        targetScroll = Math.max(0, Math.min(1, targetScroll));
      }, { passive: false });

      window.addEventListener('mousedown', e => {
        isDragging = true;
        startDragX = e.clientX;
        cursor.classList.add('drag');
      });
      window.addEventListener('mouseup', () => {
        isDragging = false;
        cursor.classList.remove('drag');
      });
      window.addEventListener('mousemove', e => {
        if (!isDragging) return;
        const dx = e.clientX - startDragX;
        startDragX = e.clientX;
        const maxScroll = track.scrollWidth - innerWidth;
        targetScroll -= dx / (maxScroll || 1);
        targetScroll = Math.max(0, Math.min(1, targetScroll));
      });
    }

    navLinks.forEach(link => {
      link.addEventListener('click', e => {
        e.preventDefault();
        if (useCustomScroll) {
          targetScroll = parseFloat(link.dataset.scrollTo);
        } else {
          const section = link.dataset.section;
          const el = document.querySelector(`.stop[data-stop-id="${section}"]`);
          if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }
      });
    });

    function updateNav() {
      let activeLink = null;

      if (useCustomScroll) {
        if (currentScroll < 0.25) activeLink = navLinks[0];
        else if (currentScroll < 0.75) activeLink = navLinks[1];
        else activeLink = navLinks[2];
      } else {
        const scrollY = window.scrollY + 120;
        const introTop = introStop.offsetTop;
        const projectsTop = projectsStop.offsetTop;
        const outroTop = outroStop.offsetTop;

        if (scrollY < projectsTop) activeLink = navLinks[0];
        else if (scrollY < outroTop) activeLink = navLinks[1];
        else activeLink = navLinks[2];
      }

      navLinks.forEach(link => link.classList.remove('active'));
      if (activeLink) activeLink.classList.add('active');
    }

    if (!useCustomScroll) {
      window.addEventListener('scroll', updateNav, { passive: true });
    }

    // --- DYNAMIC PROJECT CARDS + MOBILE REVEAL ---
    const projectsContainer = document.getElementById('projects-container');
    const cardsForReveal = [];

    projectData.forEach((p) => {
      const card = document.createElement('div');
      card.className = 'card magnetic reveal-card';
      card.innerHTML = `
        <div class="card-content">
          <div class="icon">${p.svg}</div>
          <div class="card-text-group">
            <h3>${p.title}</h3>
            <p>${p.short}</p>
          </div>
        </div>
      `;
      card.addEventListener('click', (e) => showDetail(p.id, e.currentTarget));
      projectsContainer.appendChild(card);
      cardsForReveal.push(card);
    });

    if (isMobileLayout && 'IntersectionObserver' in window) {
      const observer = new IntersectionObserver((entries, obs) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('visible');
            obs.unobserve(entry.target);
          }
        });
      }, { threshold: 0.2 });

      cardsForReveal.forEach(c => observer.observe(c));
    } else {
      cardsForReveal.forEach(c => c.classList.add('visible'));
    }

    // --- DETAIL VIEW ---
    const detailView = document.getElementById('detail-view');
    const detailViewContent = detailView.querySelector('.detail-view-content');
    const detailTitle = document.getElementById('detail-title');
    const detailDesc = document.getElementById('detail-desc');
    const detailTags = document.getElementById('detail-tags');
    const detailButtons = document.getElementById('detail-buttons');

    function showDetail(id, cardElement) {
      isModalActive = true;
      const data = projectData.find(p => p.id === id);
      if (!data) return;

      const cardRect = cardElement.getBoundingClientRect();
      const originX = cardRect.left + cardRect.width / 2;
      const originY = cardRect.top + cardRect.height / 2;
      detailViewContent.style.transformOrigin = `${originX}px ${originY}px`;

      detailTitle.textContent = data.title;
      detailDesc.textContent = data.long;
      detailTags.innerHTML = data.tags.map(t => (
        `<span class="tag">${t.icon} · ${t.text}</span>`
      )).join('');

      detailButtons.innerHTML = '';
      if (data.url) {
        const visitBtn = document.createElement('a');
        visitBtn.href = data.url;
        visitBtn.target = '_blank';
        visitBtn.rel = 'noopener noreferrer';
        visitBtn.className = 'btn primary magnetic';
        visitBtn.textContent = 'Visit Site';
        detailButtons.appendChild(visitBtn);
      }
      const closeBtn = document.createElement('button');
      closeBtn.className = 'btn magnetic';
      closeBtn.textContent = 'Close';
      closeBtn.onclick = closeDetail;
      detailButtons.appendChild(closeBtn);

      detailView.classList.add('active');
      setupMagneticButtons();
    }

    function closeDetail() {
      isModalActive = false;
      detailView.classList.remove('active');
    }
    detailView.addEventListener('click', (e) => {
      if (e.target === detailView) closeDetail();
    });

    // --- PARTICLE TRAIL (desktop only) ---
    const fx = document.getElementById('fx');
    const fxc = fx.getContext('2d');
    let DPR_FX = Math.min(2, window.devicePixelRatio || 1);

    function resizeFx(){
      fx.width = innerWidth * DPR_FX;
      fx.height = innerHeight * DPR_FX;
      fxc.setTransform(DPR_FX,0,0,DPR_FX,0,0);
    }
    resizeFx();
    window.addEventListener('resize', resizeFx);

    let particles = [];

    function fxLoop(){
      fxc.clearRect(0,0,innerWidth,innerHeight);
      if (isDragging) {
        for(let i=0; i<3; i++){
          particles.push({
            x:tx,
            y:ty,
            vx:(Math.random()-.5)*2,
            vy:(Math.random()-.5)*2,
            r:1+Math.random()*2,
            a:1
          });
        }
      }
      particles = particles.filter(p => p.a > 0.01);
      for(const p of particles){
        p.x+=p.vx;
        p.y+=p.vy;
        p.a-=0.02;
        fxc.beginPath();
        fxc.arc(p.x, p.y, p.r, 0, Math.PI*2);
        fxc.fillStyle = `rgba(127, 90, 240, ${p.a})`;
        fxc.fill();
      }
      requestAnimationFrame(fxLoop);
    }

    if (!isTouchDevice && useCustomScroll) {
      fxLoop();
    }

    // --- MAIN LOOP ---
    function masterLoop() {
      updateScroll();
      updateNav();
      requestAnimationFrame(masterLoop);
    }

    // --- INIT ---
    setupMagneticButtons();
    masterLoop();
  </script>
</body>
</html>
